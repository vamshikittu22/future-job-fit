---
phase: 02-cover-letter
plan: 07
type: execute
wave: 2
depends_on: ['02-04', '02-06']
files_modified:
  - src/features/cover-letter/components/ExportModal.tsx
  - src/features/cover-letter/lib/exportCoverLetter.ts
autonomous: true

must_haves:
  truths:
    - User can export cover letter as PDF with proper formatting
    - User can export as DOCX (editable Word document)
    - User can export as TXT (plain text)
    - Export preserves formatting from editor
    - File naming includes company and role
  artifacts:
    - path: "src/features/cover-letter/components/ExportModal.tsx"
      provides: "Export format selection and download UI"
    - path: "src/features/cover-letter/lib/exportCoverLetter.ts"
      provides: "Export functions for PDF, DOCX, TXT"
      exports: ["exportAsPDF", "exportAsDOCX", "exportAsTXT"]
  key_links:
    - from: "ExportModal"
      to: "export functions"
      via: "Button onClick handlers"
---

<objective>
Implement cover letter export functionality supporting PDF, DOCX, and TXT formats. Reuse existing export patterns from resume exports.

Purpose: Enable users to download cover letters in formats suitable for job applications.
Output: Export modal with format selection and working download functions.
</objective>

<execution_context>
@C:/Users/kittu/.config/opencode/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@src/shared/lib/export/pdf.ts
@src/shared/lib/export/docx.ts

## Existing Export Patterns

From codebase CLAUDE.md:
- PDF generation using jsPDF and html2canvas
- DOCX generation using docx library
- Export utilities in src/shared/lib/export/

## Cover Letter Export Requirements

- PDF: Business letter format with proper margins
- DOCX: Editable Word document
- TXT: Plain text with line breaks preserved

## File Naming Convention

Format: CoverLetter_{Company}_{Role}_{Date}.{ext}
Example: CoverLetter_AcmeCorp_SoftwareEngineer_2026-02-12.pdf
</context>

<tasks>

<task type="auto">
  <name>Create cover letter export utilities</name>
  <files>src/features/cover-letter/lib/exportCoverLetter.ts</files>
  <action>
    Create export functions following existing patterns:
    
    1. Define interface:
       - CoverLetterExportOptions:
         * content: string (HTML)
         * companyName: string
         * role: string
         * template?: string
    
    2. Implement exportAsPDF:
       - Use existing html2pdf.js pattern from resume exports
       - Create temporary container with formatted HTML
       - Apply business letter styling:
         * Standard margins (1 inch)
         * Professional font (Times New Roman or Inter)
         * Proper spacing
       - Generate filename: CoverLetter_{Company}_{Role}_{Date}.pdf
       - Trigger download
    
    3. Implement exportAsDOCX:
       - Use existing docx library pattern
       - Convert HTML to DOCX paragraphs
       - Preserve formatting (bold, italic, lists)
       - Apply business letter template
       - Generate filename: CoverLetter_{Company}_{Role}_{Date}.docx
       - Create and download blob
    
    4. Implement exportAsTXT:
       - Strip HTML tags
       - Preserve line breaks and spacing
       - Clean up extra whitespace
       - Generate filename: CoverLetter_{Company}_{Role}_{Date}.txt
       - Create text blob and download
    
    5. Helper functions:
       - sanitizeFilename: Remove special characters
       - formatDate: YYYY-MM-DD format
       - generateFilename: Combine parts
    
    6. Error handling:
       - Try-catch around exports
       - User-friendly error messages
       - Fallback options
  </action>
  <verify>All three export functions generate valid files</verify>
  <done>Export utilities for PDF, DOCX, and TXT</done>
</task>

<task type="auto">
  <name>Create Export Modal component</name>
  <files>src/features/cover-letter/components/ExportModal.tsx</files>
  <action>
    Create export format selection modal:
    
    1. Component structure:
       - Props:
         * isOpen: boolean
         * onClose: () => void
         * coverLetter: CoverLetter
         * jobData: JobData
    
    2. Modal layout (shadcn Dialog):
       - Title: "Export Cover Letter"
       - Description with company/role info
    
    3. Format selection:
       - 3 card options:
         * PDF (recommended):
           - Icon: FileText
           - "Professional PDF format"
           - "Best for email attachments"
         * DOCX:
           - Icon: FileEdit
           - "Editable Word document"
           - "For further editing"
         * TXT:
           - Icon: FileCode
           - "Plain text format"
           - "For online applications"
       
       - Radio-style selection
       - Visual indicators
    
    4. Preview section:
       - Show first 200 characters of content
       - Filename preview
       - Word count
    
    5. Action buttons:
       - "Export" button (disabled if no format selected)
       - Loading state during export
       - Cancel button
    
    6. Success state:
       - Show download started
       - Close button
       - Option to export another format
    
    7. Error handling:
       - Display export errors
       - Retry option
    
    8. Accessibility:
       - Focus trap in modal
       - Escape to close
       - Aria labels
  </action>
  <verify>Modal opens, shows formats, and triggers exports</verify>
  <done>ExportModal with format selection and download</done>
</task>

</tasks>

<verification>
1. PDF export generates valid PDF file
2. DOCX export generates editable Word document
3. TXT export generates clean plain text
4. Filenames follow convention
5. Modal UI works correctly
6. Errors are handled gracefully
</verification>

<success_criteria>
- All 3 export formats work correctly
- PDF maintains business letter formatting
- DOCX is editable and preserves styles
- TXT is clean plain text
- Filenames are descriptive and safe
- Export modal provides good UX
</success_criteria>

<output>
After completion, create `.planning/phases/02-cover-letter/02-07-SUMMARY.md`
</output>
