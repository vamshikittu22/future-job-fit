---
phase: 02-cover-letter
plan: 03
type: execute
wave: 1
depends_on: ['02-01', '02-02']
files_modified:
  - src/features/cover-letter/components/JobInputForm.tsx
  - src/features/cover-letter/components/GuidedPromptForm.tsx
  - src/features/cover-letter/components/ToneSelector.tsx
  - src/features/cover-letter/pages/CoverLetterWizard.tsx
  - src/app/App.tsx
autonomous: true

must_haves:
  truths:
    - User can input job description and company information
    - User answers 2-3 guided prompting questions
    - User selects tone and focus preferences
    - Wizard has clear step progression (1-3 visible)
    - Input persists if user navigates away
  artifacts:
    - path: "src/features/cover-letter/components/JobInputForm.tsx"
      provides: "Job description and company info input form"
    - path: "src/features/cover-letter/components/GuidedPromptForm.tsx"
      provides: "Guided prompting questions form"
    - path: "src/features/cover-letter/components/ToneSelector.tsx"
      provides: "Tone and focus selection UI"
    - path: "src/features/cover-letter/pages/CoverLetterWizard.tsx"
      provides: "Main wizard container with step navigation"
  key_links:
    - from: "CoverLetterWizard"
      to: "CoverLetterContext"
      via: "useCoverLetter hook"
---

<objective>
Build guided prompting wizard (Steps 1-3) for cover letter generation. Users input job details, answer guided questions, and select tone/focus before AI generation.

Purpose: Implement human-in-the-loop workflow to reduce AI detection risk and improve cover letter quality.
Output: Working wizard with Job Input, Guided Prompts, and Tone Selection steps.
</objective>

<execution_context>
@C:/Users/kittu/.config/opencode/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/phases/02-cover-letter/02-RESEARCH.md
@src/features/cover-letter/types.ts

## Wizard Steps (from research)

Step 1: Input Collection
- Job Description (textarea + URL fetch)
- Company Name
- Hiring Manager Name (optional)
- Target Role

Step 2: Guided Prompting (REQUIRED for AI detection mitigation)
- Why this company? (textarea)
- Key strengths relevant to role (2-3 items)
- Unique angle/differentiator story (optional)

Step 3: Tone & Style Selection
- Tone: Formal / Conversational / Enthusiastic
- Focus: Experience / Skills / Culture Fit / Balanced

## UI Patterns from codebase

Use shadcn/ui components (already in project):
- Form, Input, Textarea, Label
- Select, RadioGroup
- Card, Button
- Stepper or custom step indicator

Form validation with zod schemas (types already have schemas).
</context>

<tasks>

<task type="auto">
  <name>Create Job Input Form component (Step 1)</name>
  <files>src/features/cover-letter/components/JobInputForm.tsx</files>
  <action>
    Create job input form component:
    
    1. Component structure:
       - Props: onSubmit, initialData?, onSaveDraft?
       - Uses react-hook-form with zod resolver
       - Form schema: jobDescription, companyName, hiringManager?, targetRole
    
    2. Form fields:
       - Job Description: Large textarea (min 100 chars validation)
       - Company Name: Text input (required)
       - Target Role: Text input (required)
       - Hiring Manager: Text input (optional, placeholder: "Leave blank for 'Hiring Manager'")
       - Job URL: Optional URL input for auto-fetch (future feature)
    
    3. Features:
       - Real-time validation with zod
       - Character counter for job description
       - Auto-save draft to CoverLetterContext on change (debounced)
       - Continue button (disabled until valid)
       - Loading state if fetching job data
    
    4. Styling:
       - Use shadcn Card for container
       - Consistent spacing with Tailwind
       - Match existing form patterns in resume-builder
    
    5. Accessibility:
       - Proper labels
       - Aria-describedby for help text
       - Focus management
  </action>
  <verify>Component renders and form validation works</verify>
  <done>JobInputForm with all fields, validation, and auto-save</done>
</task>

<task type="auto">
  <name>Create Guided Prompt Form component (Step 2)</name>
  <files>src/features/cover-letter/components/GuidedPromptForm.tsx</files>
  <action>
    Create guided prompting form (CRITICAL for AI detection mitigation):
    
    1. Component structure:
       - Props: onSubmit, initialData?, onBack?
       - Uses coverLetterPromptAnswersSchema for validation
    
    2. Form fields (guided questions):
       - "Why are you interested in this company?"
         * Textarea, required
         * Min 50 chars, max 500 chars
         * Help text: "Be specific - mention their mission, product, or culture"
       
       - "What are your top 2-3 strengths for this role?"
         * Dynamic tag input (like skills input)
         * Min 1, max 3 strengths
         * Help text: "Match these to the job requirements"
       
       - "Do you have a unique story or angle?" (optional)
         * Textarea
         * Max 300 chars
         * Help text: "Personal anecdote that makes you memorable (optional)"
    
    3. AI Detection Warning:
       - Add prominent info banner at top:
         "Answering these questions helps create authentic cover letters that avoid AI detection."
       - Include link to "Why this matters" tooltip
    
    4. Features:
       - Real-time validation
       - Character counters
       - Auto-save to context
       - Back and Continue buttons
    
    5. UX enhancements:
       - Example placeholder text
       - Inline help tooltips
       - Progress indicator showing "Step 2 of 6"
  </action>
  <verify>Form validates coverLetterPromptAnswersSchema correctly</verify>
  <done>GuidedPromptForm with all 3 questions and AI detection notice</done>
</task>

<task type="auto">
  <name>Create Tone and Focus Selector (Step 3)</name>
  <files>src/features/cover-letter/components/ToneSelector.tsx</files>
  <action>
    Create tone and focus selection component:
    
    1. Component structure:
       - Props: onSubmit, onBack, initialTone?, initialFocus?
    
    2. Tone selection (RadioGroup):
       - Formal: "Professional and traditional business tone"
       - Conversational: "Friendly but still professional"
       - Enthusiastic: "High energy and passionate"
       - Default: Balanced (mix of all three)
       
       Use Card-based selection with visual indicators:
       - Icon for each tone
       - Brief description
       - Example phrase preview
    
    3. Focus selection (RadioGroup):
       - Experience: "Emphasize your work history and achievements"
       - Skills: "Highlight technical and soft skills"
       - Culture Fit: "Focus on alignment with company values"
       - Balanced: "Even mix of all three"
       
       Similar card-based UI
    
    4. Word count selector:
       - Slider or select: 250-400 words
       - Default: 300
       - Show "Ideal for ATS systems" badge at 300-350 range
    
    5. Features:
       - Both selections required
       - Generate button (disabled if incomplete)
       - Shows loading state during generation
       - Back button to return to prompts
  </action>
  <verify>Both tone and focus selections work and persist</verify>
  <done>ToneSelector with visual card options and word count control</done>
</task>

<task type="auto">
  <name>Create Cover Letter Wizard container</name>
  <files>src/features/cover-letter/pages/CoverLetterWizard.tsx</files>
  <action>
    Create main wizard container integrating all steps:
    
    1. Component structure:
       - Uses CoverLetterContext for state
       - Step state: 'input' | 'prompts' | 'tone' | 'generating' | 'variants'
       - Wraps step components
    
    2. Step navigation:
       - Visual stepper showing: Job Details → Your Story → Style → Review
       - Current step highlighted
       - Completed steps show checkmark
       - Click to go back to completed steps
    
    3. Step content:
       - Step 1: JobInputForm
       - Step 2: GuidedPromptForm
       - Step 3: ToneSelector
       - Step 4: Generating state (progress indicator)
    
    4. Generation flow:
       - On Step 3 submit, call coverLetterAI.generateCoverLetters()
       - Show loading state with progress message
       - On success, save variants to context
       - Navigate to variants view (separate page/component)
    
    5. Error handling:
       - Generation error shows retry option
       - Validation errors prevent progression
       - Network errors show helpful message
    
    6. Header and layout:
       - Page title: "Create Cover Letter"
       - Subtitle: "Tailored to your target job"
       - Consistent with resume wizard layout
  </action>
  <verify>Wizard steps through all 3 steps correctly</verify>
  <done>CoverLetterWizard with step navigation and component integration</done>
</task>

<task type="auto">
  <name>Add route for Cover Letter Wizard</name>
  <files>src/app/App.tsx</files>
  <action>
    Add route for cover letter wizard:
    
    1. Import CoverLetterWizard component
    2. Add route: /cover-letter/create
    3. Wrap with CoverLetterProvider (in main App or route)
    4. Ensure navigation from home page works
    
    The route should be accessible from the main navigation.
  </action>
  <verify>Route /cover-letter/create loads wizard</verify>
  <done>Route added and wizard is accessible</done>
</task>

</tasks>

<verification>
1. All 3 wizard steps render correctly
2. Form validation prevents progression with invalid data
3. Data persists in CoverLetterContext
4. Step navigation works (forward and back)
5. Generate button triggers AI service call
</verification>

<success_criteria>
- User can complete Steps 1-3 of cover letter creation
- Job details, guided answers, and tone preferences are captured
- Wizard has clear visual step indicator
- Data persists if user refreshes page
- Generate action calls AI service with correct parameters
</success_criteria>

<output>
After completion, create `.planning/phases/02-cover-letter/02-03-SUMMARY.md`
</output>
