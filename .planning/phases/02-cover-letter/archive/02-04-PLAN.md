---
phase: 02-cover-letter
plan: 04
type: execute
wave: 1
depends_on: ['02-01', '02-03']
files_modified:
  - src/features/cover-letter/components/RichTextEditor.tsx
  - src/features/cover-letter/components/EditorToolbar.tsx
autonomous: false

must_haves:
  truths:
    - User can edit cover letter content with rich text formatting
    - Editor supports bold, italic, lists, and paragraphs
    - Editor persists content on change
    - Editor has proper toolbar with formatting controls
    - Content exports as HTML for final output
  artifacts:
    - path: "src/features/cover-letter/components/RichTextEditor.tsx"
      provides: "Tiptap-based rich text editor"
      exports: ["RichTextEditor"]
    - path: "src/features/cover-letter/components/EditorToolbar.tsx"
      provides: "Formatting toolbar for editor"
  key_links:
    - from: "RichTextEditor"
      to: "CoverLetterContext"
      via: "onChange callback updating editedContent"
---

<objective>
Implement Tiptap-based rich text editor for cover letter editing. Supports formatting, auto-save, and humanization coaching integration.

Purpose: Enable users to refine AI-generated cover letters with professional formatting and receive humanization suggestions.
Output: RichTextEditor component with toolbar, formatting, and persistence.
</objective>

<execution_context>
@C:/Users/kittu/.config/opencode/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/phases/02-cover-letter/02-RESEARCH.md

## Tiptap Setup Required

Per research document:
```bash
npm install @tiptap/react @tiptap/starter-kit @tiptap/extension-placeholder
```

## Tiptap Implementation Pattern

```typescript
import { useEditor, EditorContent } from '@tiptap/react'
import StarterKit from '@tiptap/starter-kit'
import Placeholder from '@tiptap/extension-placeholder'

const editor = useEditor({
  extensions: [
    StarterKit,
    Placeholder.configure({ 
      placeholder: 'Start writing your cover letter...' 
    })
  ],
  content: coverLetterContent,
  onUpdate: ({ editor }) => {
    setCoverLetterContent(editor.getHTML())
  }
})
```

## Features Required

- Bold, italic formatting
- Bullet lists, numbered lists
- Paragraphs
- Placeholder text
- Auto-save on change (debounced)
- Character/word count
- Toolbar with formatting buttons
</context>

<tasks>

<task type="auto">
  <name>Install Tiptap dependencies</name>
  <files>package.json</files>
  <action>
    Install required Tiptap packages:
    
    ```bash
    npm install @tiptap/react @tiptap/starter-kit @tiptap/extension-placeholder
    ```
    
    This adds the core Tiptap packages needed for the rich text editor.
  </action>
  <verify>npm list @tiptap/react shows installed</verify>
  <done>Tiptap packages installed</done>
</task>

<task type="auto">
  <name>Create Editor Toolbar component</name>
  <files>src/features/cover-letter/components/EditorToolbar.tsx</files>
  <action>
    Create formatting toolbar for Tiptap editor:
    
    1. Component structure:
       - Props: editor (Tiptap Editor instance)
       - Toolbar with button groups
    
    2. Formatting buttons:
       - Bold (B): toggleBold
       - Italic (I): toggleItalic
       - Bullet list: toggleBulletList
       - Numbered list: toggleOrderedList
       - Paragraph: setParagraph
    
    3. Button styling:
       - Use shadcn Toggle or Button components
       - Active state styling when format is active
       - Icon-based buttons (use lucide-react icons)
       - Group buttons logically with separators
    
    4. Accessibility:
       - aria-labels for all buttons
       - Keyboard shortcuts (Ctrl+B, Ctrl+I)
       - Focus visible states
    
    5. Responsive:
       - Collapse to icon-only on mobile
       - Wrap gracefully on small screens
  </action>
  <verify>Toolbar buttons toggle formatting correctly</verify>
  <done>EditorToolbar with all formatting controls</done>
</task>

<task type="auto">
  <name>Create Rich Text Editor component</name>
  <files>src/features/cover-letter/components/RichTextEditor.tsx</files>
  <action>
    Create RichTextEditor component with Tiptap:
    
    1. Component structure:
       - Props:
         * content: string (initial HTML content)
         * onChange: (html: string) => void
         * placeholder?: string
         * readOnly?: boolean
         * className?: string
    
    2. Tiptap setup:
       - Use useEditor hook
       - Extensions: StarterKit, Placeholder
       - Configure StarterKit:
         * Enable bold, italic, bulletList, orderedList
         * Disable heading (cover letters don't use headings)
       - Configure Placeholder with provided text
    
    3. Change handling:
       - onUpdate callback calls onChange with editor.getHTML()
       - Debounce onChange calls (500ms) to reduce re-renders
       - Track word count and character count
    
    4. UI layout:
       - Toolbar at top (EditorToolbar component)
       - Editor area below
       - Word count at bottom right
       - Clean border and focus ring
    
    5. Features:
       - Auto-focus on mount (optional)
       - Placeholder when empty
       - Proper padding and line height
       - Match shadcn Input styling
    
    6. Performance:
       - Memoize editor config
       - Only re-create editor when content prop changes significantly
       - Use React.memo for component
    
    7. Integration prep:
       - Support for future humanization highlights
       - Support for future AI detection risk markers
  </action>
  <verify>Editor renders, formats text, and calls onChange with HTML</verify>
  <done>RichTextEditor with full formatting and change handling</done>
</task>

<task type="checkpoint:human-verify">
  <what-built>Rich text editor with Tiptap for cover letter editing</what-built>
  <how-to-verify>
    1. Navigate to cover letter creation flow
    2. After AI generation, the editor should appear with generated content
    3. Test formatting:
       - Select text and click Bold - text should become bold
       - Click Italic - text should become italic
       - Add bullet list items
       - Add numbered list items
    4. Type new text - changes should persist
    5. Check word count updates correctly
    6. Verify placeholder appears when content is empty
  </how-to-verify>
  <resume-signal>Type "approved" or describe any formatting issues</resume-signal>
</task>

</tasks>

<verification>
1. Editor renders without errors
2. All formatting buttons work (bold, italic, lists)
3. onChange callback receives valid HTML
4. Word count displays correctly
5. Placeholder shows when empty
6. Styling matches shadcn design system
</verification>

<success_criteria>
- Tiptap editor integrated with React
- Toolbar provides all required formatting options
- Editor outputs valid HTML
- Changes are debounced and efficient
- Component is reusable and well-typed
</success_criteria>

<output>
After completion, create `.planning/phases/02-cover-letter/02-04-SUMMARY.md`
</output>
