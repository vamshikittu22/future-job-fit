---
phase: 02-cover-letter
plan: 06
type: execute
wave: 2
depends_on: ['02-02', '02-05']
files_modified:
  - src/features/cover-letter/components/ATSScorePanel.tsx
  - src/features/cover-letter/lib/coverLetterATS.ts
  - src/features/cover-letter/components/SuggestionsList.tsx
autonomous: true

must_haves:
  truths:
    - System calculates ATS score for cover letters (0-100)
    - Score breakdown shows: keyword integration, format, tone, length
    - Specific suggestions for improvement provided
    - High-risk phrases flagged for humanization
    - Score updates in real-time as user edits
  artifacts:
    - path: "src/features/cover-letter/lib/coverLetterATS.ts"
      provides: "ATS scoring algorithm for cover letters"
      exports: ["calculateCoverLetterATS", "detectRiskPhrases"]
    - path: "src/features/cover-letter/components/ATSScorePanel.tsx"
      provides: "ATS score display with breakdown"
    - path: "src/features/cover-letter/components/SuggestionsList.tsx"
      provides: "Improvement suggestions UI"
  key_links:
    - from: "ATSScorePanel"
      to: "coverLetterAI.analyzeForATS"
      via: "API call on content change"
---

<objective>
Implement ATS scoring system specifically for cover letters. Different from resume ATS - focuses on keyword integration quality, format compliance, tone alignment, and length optimization.

Purpose: Help users optimize cover letters for ATS systems and human recruiters.
Output: ATS scoring algorithm and UI components for score display and suggestions.
</objective>

<execution_context>
@C:/Users/kittu/.config/opencode/get-shit-done/workflows/execute-plan.md
</execution_context>

<context>
@.planning/phases/02-cover-letter/02-RESEARCH.md

## Cover Letter ATS Algorithm

From research:
```typescript
interface CoverLetterATSScore {
  overall: number;
  breakdown: {
    keywordIntegration: number;  // 30% - Are keywords naturally woven in?
    formatCompliance: number;    // 25% - Proper business letter format?
    toneAlignment: number;       // 15% - Matches company culture?
    lengthOptimization: number;  // 10% - 250-400 words ideal
    uniqueness: number;          // 20% - Generic phrase detection
  };
  suggestions: string[];
  riskFlags: string[];           // AI detection risk markers
}
```

## Scoring Weights

- Keyword integration quality: 30% (vs 40% for resumes)
- Format compliance: 25% (business letter structure)
- Tone alignment: 15% (matches company culture)
- Length optimization: 10% (250-400 words ideal)
- Uniqueness: 20% (generic phrase detection)

## High-Risk Phrases to Flag

- "I am writing to express my interest"
- "I am excited to apply"
- "I believe I am a perfect fit"
- "I have attached my resume"
- "Thank you for your time and consideration"
- "I look forward to hearing from you"
</context>

<tasks>

<task type="auto">
  <name>Create cover letter ATS scoring algorithm</name>
  <files>src/features/cover-letter/lib/coverLetterATS.ts</files>
  <action>
    Create ATS scoring utilities for cover letters:
    
    1. Define interfaces:
       - CoverLetterATSScore with breakdown
       - RiskPhrase with location and suggestion
    
    2. Implement calculateCoverLetterATS function:
       - Parameters: letter: string, jobDescription: JobData
       - Returns: CoverLetterATSScore
       
       Scoring logic:
       a) Keyword Integration (30%):
          - Extract keywords from job description
          - Check if keywords appear in context (not just listed)
          - Score based on natural integration
       
       b) Format Compliance (25%):
          - Check for date, address block, salutation
          - Check for proper closing and signature block
          - Validate paragraph structure
       
       c) Tone Alignment (15%):
          - Simple heuristic based on word choice
          - Check for overly formal vs conversational markers
       
       d) Length Optimization (10%):
          - Word count scoring:
            * 250-400 words = 100%
            * <250 words = (count/250)*100
            * >400 words = 100 - ((count-400)/100)*20
       
       e) Uniqueness (20%):
          - Detect generic phrases
          - Score = 100 - (riskPhrases.length * 10)
    
    3. Implement detectRiskPhrases function:
       - Returns array of found generic phrases
       - Include line/position info
       - Provide replacement suggestions
    
    4. Implement generateSuggestions function:
       - Based on low scores, generate specific suggestions
       - Categorized by area (format, content, tone)
    
    5. Export all utilities
  </action>
  <verify>Algorithm produces scores 0-100 with valid breakdown</verify>
  <done>ATS scoring algorithm with all 5 factors</done>
</task>

<task type="auto">
  <name>Create ATS Score Panel component</name>
  <files>src/features/cover-letter/components/ATSScorePanel.tsx</files>
  <action>
    Create score display panel:
    
    1. Component structure:
       - Props:
         * score: CoverLetterATSScore
         * onRefresh?: () => void
         * isLoading?: boolean
    
    2. Overall score display:
       - Large circular progress indicator
       - Score number (0-100)
       - Status label ("Excellent", "Good", "Needs Work")
       - Color coding (green/yellow/red)
    
    3. Breakdown section:
       - 5 progress bars for each factor
       - Labels with percentages
       - Tooltips explaining each factor
       - Color coded per score
    
    4. Risk flags section:
       - Only show if riskFlags.length > 0
       - List of flagged phrases
       - Severity indicators
       - "Humanize" suggestion banner
    
    5. Actions:
       - "Refresh Score" button
       - Last updated timestamp
       - Loading state
    
    6. Layout:
       - Collapsible sections
       - Sticky positioning optional
       - Responsive design
       - Match shadcn Card styling
  </action>
  <verify>Panel displays all score components correctly</verify>
  <done>ATSScorePanel with overall score and breakdown</done>
</task>

<task type="auto">
  <name>Create Suggestions List component</name>
  <files>src/features/cover-letter/components/SuggestionsList.tsx</files>
  <action>
    Create improvement suggestions UI:
    
    1. Component structure:
       - Props:
         * suggestions: string[]
         * riskFlags?: RiskPhrase[]
         * onApplySuggestion?: (suggestion: string) => void
    
    2. Suggestions display:
       - Categorized by type (Icon + category)
       - Expandable cards for each suggestion
       - Priority ordering (high impact first)
    
    3. Risk phrase highlighting:
       - Special section for AI detection risks
       - Show phrase + context
       - Suggest replacement
       - Quick fix button
    
    4. Interactive features:
       - "Apply" button for applicable suggestions
       - Mark as done / dismiss
       - Show impact (e.g., "+5 points")
    
    5. Empty state:
       - Celebrate when score is high
       - "Your cover letter looks great!"
    
    6. Integration:
       - Use in edit page alongside editor
       - Update as user types (debounced)
  </action>
  <verify>Suggestions render and are categorized</verify>
  <done>SuggestionsList with actionable improvements</done>
</task>

</tasks>

<verification>
1. ATS scoring produces valid 0-100 scores
2. All 5 factors are calculated correctly
3. Risk phrases are detected accurately
4. Score panel displays breakdown clearly
5. Suggestions are relevant and actionable
</verification>

<success_criteria>
- ATS algorithm calculates scores for cover letters
- Score breakdown shows all 5 factors with weights
- Risk phrases are flagged with locations
- UI displays scores clearly with color coding
- Suggestions help users improve their scores
</success_criteria>

<output>
After completion, create `.planning/phases/02-cover-letter/02-06-SUMMARY.md`
</output>
